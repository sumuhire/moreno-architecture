{% extends 'base.html.twig' %}

{% block title %}Nimble{% endblock %}

{% block header %}
    {% include 'headerI.html.twig' %}
{% endblock %}

{% block body %}
    {% include 'Default/subHeader.html.twig' %}           
        
{# Sub-navbar : Degree Types #}

{# nav tabs #}

<ul class="nav nav-tabs nav-fill">
    <li class="nav-item">
        <a class="nav-link active" data-toggle="tab" id="AAA-tab" href="#AAA" role="tab" aria-controls="AAA" aria-selected="true" >Undergraduate</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" data-toggle="tab" id="BBB-tab" href="#BBB" role="tab" aria-controls="BBB" aria-selected="false" >Graduate</a>
    </li>
    {# <li class="nav-item">
        <a class="nav-link" data-toggle="tab" id="CCC-tab" href="#CCC" role="tab" aria-controls="CCC" aria-selected="true" style="height:80%;border:0;color:#353A40;">Doctoral</a>
    </li> #}
    <li class="nav-item">
        <a class="nav-link" data-toggle="tab" id="DDD-tab" href="#DDD" role="tab" aria-controls="DDD" aria-selected="true" >Continuing education</a>
    </li>
</ul>

{# End Sub-navbar :  Degree Types #}

{# nav panes #}

<div class="tab-content">
    
    {# Part A: Undergraduate education #}

    <div class="tab-pane fade active show" id="AAA" role="tabpanel" aria-labelledby="AAA-tab" >
        <div class="content-list-body">        
            <div class="card-list" style='background-color: #F7F9FA;margin-bottom:200px'>
                <div class="card-list-head">
                    <h4 style='letter-spacing: 0.05em;'>Faculties</h4>
                </div>
                {% if is_granted('ROLE_SCHOOL_USER_ADMIN') %}
                <div class="card-list-body" >
                    {% for faculty in faculties %}
                    <div class="card card-task" style='background-color: white;'>
                        <div class="card-body">
                            <div class="card-title">
                                <a data-toggle="collapse" href="#{{ faculty.label |replace({' ': '-' ,',': '-' }) }}" role="button" aria-expanded="false" aria-controls="{{ faculty.label |replace({' ': '-' }) }}">
                                    <h5 data-filter-by="text" style='letter-spacing: 0.05em;'>{{ faculty.label }}</h5>
                                </a>
                                {# <span class="text-small">Today</span> #}
                            </div>
                            <div class="card-meta">                             
                            {% if faculty.schoolUsers is not empty %}
                            {% set break = false %}
                            {% for schoolUser in faculty.schoolUsers if not break %}
                            <ul class="avatars" style="display:inline;margin-left:-12px">
                                <li> 
                                    <a href="{{ path("visitProfile", {id: schoolUser.user.id}) }}" data-toggle="tooltip" title="{{ schoolUser.user.firstname | capitalize }} {{ schoolUser.user.lastname | capitalize }}">
                                        <img  class="avatar" src="{{ asset('uploads/picture/' ~ schoolUser.user.picture) }}" />
                                    </a>
                                </li> 
                            </ul>
                            {% set break = loop.index0 > 1 %}
                            {% endfor %}
                            {% endif %}
                                <div class="dropdown card-options">
                                    <button class="btn-options" type="button" id="task-dropdown-button-1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="material-icons">more_vert</i>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-right">
                                        <a class="dropdown-item" href="#">Edit</a>
                                        <div class="dropdown-divider"></div>
                                        <a class="dropdown-item text-danger" href="#">Delete</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>          
                               
                    <div id="{{ faculty.label |replace({' ': '-' ,',': '-' }) }}" class="collapse" aria-labelledby="{{ faculty.label |replace({' ': '-' }) }}" >
                        {% if faculty.issuances is not empty %} 

                        {% for degreeField in faculty.degreeField %}
                        
                        {% if degreeField.issuances is not empty %}
                        
                        {% for issuance in degreeField.issuances %}

                        {% if issuance.degreeType.id == '81892af4-f7c6-11e8-8302-323a8a08878d'%}
                        
                        <div class="row content-list-head">
                            <div class="col-auto">
                                <h5 style="color:#353A40;letter-spacing:0.05em">{{ degreeField.label }}</h5>
                            </div>
                        </div>
                        
                        <div class="content-list-body row" >        
                            <div class="col-md-6">   
                            {# class list #}
                            
                                <div class="card card-team" style="background-color:white;height:218px" >
                                    {% if issuance.getGraduateUserInvites() is empty %}
                                    <div class="progress">
                                        <div class="progress-bar bg-warning" role="progressbar" style="width: 100%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    {% else %}
                                     <div class="progress">
                                        <div class="progress-bar bg" style="width:100%; background-color: #006400"></div>
                                    </div>
                                    {% endif %}
                                    <div class="card-body" >
                                        <div class="dropdown card-options">
                                            <button class="btn-options" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <i class="material-icons">more_vert</i>
                                            </button>
                                            <div class="dropdown-menu dropdown-menu-right">
                                                <a class="dropdown-item" href="#">Edit</a>
                                                <div class="dropdown-divider"></div>
                                                <a class="dropdown-item text-danger" data-toggle="modal" data-target="#confirmDelete" data-title="Delete User" data-message="Are you sure you want to delete this user ?" >Delete</a>
                                            </div>
                                        </div>
                                        <div class="card-title">
                                            <a href="{{ path('issuances', { issuance: issuance.id }) }}">
                                                <h5 data-filter-by="text" style="color:#353A40;letter-spacing: 0.05em">Class {{ issuance.classYearStart|date('Y') }} - {{ issuance.classYearEnd|date('Y') }} | <span style='font-size:small;letter-spacing: 0.05em!important'>{{ issuance.degreeField.label | capitalize }} <span></h5>
                                            </a>
                                            <span style='font-size:small;letter-spacing: 0.05em'> 
                                            {% if issuance.degreeTitle.label > 45 %}
                                            {% set degreeName =  issuance.degreeTitle.label|slice(0, 45) %}
                                            {% set degreeName  = schoolName ~ '...' %}
                                        {% else %}
                                            {% set degreeName  =  issuance.degreeTitle.label %}
                                        {% endif %}

                                        {{ degreeName  |capitalize }}
                                            </span>
                                        </div> 
                                            
                                        <div class="card-meta d-flex">
                                        

                                        {% if issuance.GraduateUsers is not empty %}
                                            {% set break = false %}
                                            {% for graduates in issuance.GraduateUsers if not break %}
                                                {% if loop.first %}
                                                     <ul class="avatars" style="display:inline;">
                                                    <li> 
                                                        <a href="{{ path("visitProfile", {id: graduates.user.id }) }}" data-toggle="tooltip" title="{{ graduates.user.firstname | capitalize }} {{ graduates.user.lastname | capitalize }}">
                                                            <img class="avatar" src="{{ asset('uploads/picture/' ~ graduates.user.picture) }}" />
                                                        </a>
                                                    </li> 
                                                </ul>

                                                {% else %}
                                                <ul class="avatars" style="display:inline;margin-left:-13px!important">
                                                    <li> 
                                                        <a href="{{ path("visitProfile", {id: graduates.user.id }) }}" data-toggle="tooltip" title="{{ graduates.user.firstname | capitalize }} {{ graduates.user.lastname | capitalize }}">
                                                            <img class="avatar" src="{{ asset('uploads/picture/' ~ graduates.user.picture) }}" />
                                                        </a>
                                                    </li> 
                                                </ul>
                                                {% endif %}
                                            {% set break = loop.index0 > 3 %}
                                            {% endfor %}
                                        {% endif %}
                                                        {# endDate and startDate are strings or DateTime objects #}
                                            {# {% if issuance.dueDate < date() %}
                                            <span class="text-small" data-filter-by="text" title='{{ issuance.dueDate|date('Y') }}' style='color:grey'>Due on {{issuance.dueDate|date('d-m-Y') }}</span>
                                            {% else %}

                                                {% set difference = date(issuance.dueDate).diff(date()) %}
                                                {% set leftDays = difference.days %}
                                                {% if leftDays == 1 %}
                                            <span class="text-small" data-filter-by="text" title='{{ issuance.dueDate|date('Y') }}' style='color:grey'>Due 1 days</span>
                                                {% elseif leftDays == 0 %}
                                            <span class="text-small" data-filter-by="text" title='{{ issuance.dueDate|date('Y') }}' style='color:grey'>Due today</span>
                                                {% else %}                           
                                            <span class="text-small" data-filter-by="text" title='{{ issuance.dueDate|date('Y') }}' style='color:grey'>Due {{ leftDays }} days</span>
                                                {% endif %}
                                            {% endif %} #}
                                        </div>
                                    </div>
                                </div>
                            
                            
                                {# End class list #}
                            
                                {# Modal Delete Dialog #}
                                <div class="modal fade" id="confirmDelete" role="dialog" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                    <div class="modal-header" style="background-color:white;border-bottom:1px solid #F4F3EF;">
                                        <h4 class="modal-title text-left" style="color:#ffc107;padding-right:320px">Delete Faculty</h4>
                                        <i class="fas fa-times" data-dismiss="modal" style="color:#353A40;padding-top:10px"></i>
                                    </div>
                                    <div class="modal-body" style="height:200px;margin:auto;color:#353A40;padding-top:30px">
                                        <p style="color:#353A40">
                                        
                                        The <strong> Graduation class {{ issuance.classYearStart|date('Y') }} - {{ issuance.classYearEnd|date('Y') }} - Master in business engineering </strong>  will be removed from <strong>{{ issuance.school.name |capitalize}}</strong> account. 
                                        </p>
                                        <p>
                                        You can edit the faculty if you want to change something.
                                        Are you sure you want to delete it?
                                        </p>

                                    </div>
                                    <div class="modal-footer" style="background-color:white;border-top:1px solid #F4F3EF;">
                                        <button class="btn btn-link text-#353A40" style="color:#353A40;" data-dismiss="modal">Cancel</button>
                                        {# <a class="btn btn-outline-primary" style="color:#353A40;" id="confirm" href="{{ path("deleteFaculty", { "faculty": faculty.id }) }}">
                                            Delete
                                        </a> #}
                                    </div>
                                    </div>
                                </div>
                                </div>
                                {# End Modal Delete Dialog #}

                            </div>  
                               
                        
                    
                        </div>
                        {% endif %}
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                        {% else %}
                        <div class="row content-list-head">
                            <div class="col-auto">
                                <p style="color:#ffc107">As of today, no proof of degree have been issued. </p>
                            </div>
                        </div>

                        {% endif %}
                    </div>
                    
                {% endfor %}
                </div>
            
                {% endif %}
            </div>    
        </div>
    </div> 
  
    {# End Part A #}

    {# Part B - Postrgraduate education #}
    <div class="tab-pane fade" id="BBB" role="tabpanel" aria-labelledby="BBB-tab">
        <div class="content-list-body">       
            <div class="card-list" style='background-color: #F7F9FA;margin-bottom:200px'>
                <div class="card-list-head">
                    <h4 style='letter-spacing: 0.05em;'>Faculties</h4>
                </div>
                {% if is_granted('ROLE_SCHOOL_USER_ADMIN') %}
                <div class="card-list-body" >
                    {% for faculty in faculties %}         
                    <div class="card card-task" style='background-color: white;'>
                        <div class="card-body">
                            <div class="card-title">
                                <a data-toggle="collapse" href="#{{ faculty.label |replace({' ': '-' ,',': '-' }) }}" role="button" aria-expanded="false" aria-controls="{{ faculty.label |replace({' ': '-' }) }}">
                                    <h5 data-filter-by="text" style='letter-spacing: 0.05em;'>{{ faculty.label }}</h5>
                                </a>
                                {# <span class="text-small">Today</span> #}
                            </div>
                            <div class="card-meta">          
                            {% if faculty.schoolUsers is not empty %}
                            {% set break = false %}
                            {% for schoolUser in faculty.schoolUsers if not break %}
                            <ul class="avatars" style="display:inline;margin-left:-12px">
                                <li> 
                                    <a href="{{ path("visitProfile", {id: schoolUser.user.id}) }}" data-toggle="tooltip" title="{{ schoolUser.user.firstname | capitalize }} {{ schoolUser.user.lastname | capitalize }}">
                                        <img  class="avatar" src="{{ asset('uploads/picture/' ~ schoolUser.user.picture) }}" />
                                    </a>
                                </li> 
                            </ul>
                            {% set break = loop.index0 > 1 %}
                            {% endfor %}
                        {% endif %}
                                <div class="dropdown card-options">
                                    <button class="btn-options" type="button" id="task-dropdown-button-1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="material-icons">more_vert</i>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-right">
                                        <a class="dropdown-item" href="#">Edit</a>
                                        <div class="dropdown-divider"></div>
                                        <a class="dropdown-item text-danger" href="#">Delete</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
  
                    <div id="{{ faculty.label |replace({' ': '-' ,',': '-' }) }}" class="collapse" aria-labelledby="{{ faculty.label |replace({' ': '-' }) }}" >
                        {% if faculty.issuances is not empty %}

                        {% for degreeField in faculty.degreeField %}
                        
                        {% if degreeField.issuances is not empty %}
                        
                        {% for issuance in degreeField.issuances %}

                        {% if issuance.degreeType.id == '818935e4-f7c6-11e8-8302-323a8a08878d'%}
                        
                            <div class="row content-list-head">
                            <div class="col-auto">
                                <h5 style="color:#353A40;letter-spacing:0.05em">{{ degreeField.label }}</h5>
                            </div>
                        </div>
                        
                        <div class="content-list-body row" >

                        
                            
                            <div class="col-md-6">   
                            {# class list #}
                            
                                <div class="card card-team" style="background-color:white;height:218px" >
                                    {% if issuance.getGraduateUserInvites() is empty %}
                                    <div class="progress">
                                        <div class="progress-bar bg-warning" role="progressbar" style="width: 100%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    {% else %}
                                        <div class="progress">
                                        <div class="progress-bar bg" style="width:100%; background-color: #006400"></div>
                                    </div>
                                    {% endif %}
                                    <div class="card-body" >
                                        <div class="dropdown card-options">
                                            <button class="btn-options" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <i class="material-icons">more_vert</i>
                                            </button>
                                            <div class="dropdown-menu dropdown-menu-right">
                                                <a class="dropdown-item" href="#">Edit</a>
                                                <div class="dropdown-divider"></div>
                                                <a class="dropdown-item text-danger" data-toggle="modal" data-target="#confirmDelete" data-title="Delete User" data-message="Are you sure you want to delete this user ?" >Delete</a>
                                            </div>
                                        </div>
                                        <div class="card-title">
                                            <a href="{{ path('issuances', { issuance: issuance.id }) }}">
                                                <h5 data-filter-by="text" style="color:#353A40">Class {{ issuance.classYearStart|date('Y') }} - {{ issuance.classYearEnd|date('Y') }} | <span style='font-size:small;letter-spacing: 0.05em'>{{ issuance.degreeField.label | capitalize }} <span></h5>
                                            </a>
                                            <span style='font-size:small'> 
                                            {% if issuance.degreeTitle.label > 45 %}
                                            {% set degreeName =  issuance.degreeTitle.label|slice(0, 45) %}
                                            {% set degreeName  = schoolName ~ '...' %}
                                        {% else %}
                                            {% set degreeName  =  issuance.degreeTitle.label %}
                                        {% endif %}

                                        {{ degreeName  |capitalize }}
                                            </span>
                                        </div> 
                                            
                                        <div class="card-meta d-flex">
                                        

                                        {% if issuance.GraduateUsers is not empty %}
                                            {% set break = false %}
                                            {% for graduates in issuance.GraduateUsers if not break %}
                                                {% if loop.first %}
                                                        <ul class="avatars" style="display:inline;">
                                                    <li> 
                                                        <a href="{{ path("visitProfile", {id: graduates.user.id }) }}" data-toggle="tooltip" title="{{ graduates.user.firstname | capitalize }} {{ graduates.user.lastname | capitalize }}">
                                                            <img class="avatar" src="{{ asset('uploads/picture/' ~ graduates.user.picture) }}" />
                                                        </a>
                                                    </li> 
                                                </ul>

                                                {% else %}
                                                <ul class="avatars" style="display:inline;margin-left:-13px">
                                                    <li> 
                                                        <a href="{{ path("visitProfile", {id: graduates.user.id }) }}" data-toggle="tooltip" title="{{ graduates.user.firstname | capitalize }} {{ graduates.user.lastname | capitalize }}">
                                                            <img class="avatar" src="{{ asset('uploads/picture/' ~ graduates.user.picture) }}" />
                                                        </a>
                                                    </li> 
                                                </ul>
                                                {% endif %}
                                            {% set break = loop.index0 > 3 %}
                                            {% endfor %}
                                        {% endif %}
                                                        {# endDate and startDate are strings or DateTime objects #}
                                            {# {% if issuance.dueDate < date() %}
                                            <span class="text-small" data-filter-by="text" title='{{ issuance.dueDate|date('Y') }}' style='color:grey'>Due on {{issuance.dueDate|date('d-m-Y') }}</span>
                                            {% else %}

                                                {% set difference = date(issuance.dueDate).diff(date()) %}
                                                {% set leftDays = difference.days %}
                                                {% if leftDays == 1 %}
                                            <span class="text-small" data-filter-by="text" title='{{ issuance.dueDate|date('Y') }}' style='color:grey'>Due 1 days</span>
                                                {% elseif leftDays == 0 %}
                                            <span class="text-small" data-filter-by="text" title='{{ issuance.dueDate|date('Y') }}' style='color:grey'>Due today</span>
                                                {% else %}                           
                                            <span class="text-small" data-filter-by="text" title='{{ issuance.dueDate|date('Y') }}' style='color:grey'>Due {{ leftDays }} days</span>
                                                {% endif %}
                                            {% endif %} #}
                                        </div>
                                    </div>
                                </div>
                            
                            
                                {# End class list #}
                            
                                {# Modal Delete Dialog #}
                                <div class="modal fade" id="confirmDelete" role="dialog" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                    <div class="modal-header" style="background-color:white;border-bottom:1px solid #F4F3EF;">
                                        <h4 class="modal-title text-left" style="color:#ffc107;padding-right:320px">Delete Faculty</h4>
                                        <i class="fas fa-times" data-dismiss="modal" style="color:#353A40;padding-top:10px"></i>
                                    </div>
                                    <div class="modal-body" style="height:200px;margin:auto;color:#353A40;padding-top:30px">
                                        <p style="color:#353A40">
                                        
                                        The <strong> Graduation class {{ issuance.classYearStart|date('Y') }} - {{ issuance.classYearEnd|date('Y') }} - Master in business engineering </strong>  will be removed from <strong>{{ issuance.school.name |capitalize}}</strong> account. 
                                        </p>
                                        <p>
                                        You can edit the faculty if you want to change something.
                                        Are you sure you want to delete it?
                                        </p>

                                    </div>
                                    <div class="modal-footer" style="background-color:white;border-top:1px solid #F4F3EF;">
                                        <button class="btn btn-link text-#353A40" style="color:#353A40;" data-dismiss="modal">Cancel</button>
                                        {# <a class="btn btn-outline-primary" style="color:#353A40;" id="confirm" href="{{ path("deleteFaculty", { "faculty": faculty.id }) }}">
                                            Delete
                                        </a> #}
                                    </div>
                                    </div>
                                </div>
                                </div>
                                {# End Modal Delete Dialog #}

                            </div>  
                        </div>
                        {% endif %}
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                        {% else %}
                        <div class="row content-list-head">
                            <div class="col-auto">
                                <p style="color:#ffc107">As of today, no proof of degree have been issued. </p>
                            </div>
                        </div>

                        {% endif %}
                    </div>
                    
                {% endfor %}
                </div>
                {% endif %}
            </div>    
        </div>
    </div> 
    <div class="tab-pane fade" id="CCC" role="tabpanel" aria-labelledby="CCC-tab">
        <div class="content-list-body">  
        
                <div class="card-list" style='background-color: #F7F9FA;margin-bottom:200px'>
                    <div class="card-list-head">
                        <h4 style='letter-spacing: 0.05em;'>Faculties</h4>
                    </div>
    
                    {% if is_granted('ROLE_SCHOOL_USER_ADMIN') %}
                    <div class="card-list-body" >
                        {% for faculty in faculties %}         
                        <div class="card card-task" style='background-color: white;'>
                            <div class="card-body">
                                <div class="card-title">
                                    <a data-toggle="collapse" href="#{{ faculty.label |replace({' ': '-' ,',': '-' }) }}" role="button" aria-expanded="false" aria-controls="{{ faculty.label |replace({' ': '-' }) }}">
                                        <h5 data-filter-by="text" style='letter-spacing: 0.05em;'>{{ faculty.label }}</h5>
                                    </a>
                                    {# <span class="text-small">Today</span> #}
                                </div>
                                <div class="card-meta">
                                    
                                {% if faculty.schoolUsers is not empty %}
                                {% set break = false %}
                                {% for schoolUser in faculty.schoolUsers if not break %}
                                <ul class="avatars" style="display:inline;margin-left:-12px">
                                    <li> 
                                        <a href="{{ path("visitProfile", {id: schoolUser.user.id}) }}" data-toggle="tooltip" title="{{ schoolUser.user.firstname | capitalize }} {{ schoolUser.user.lastname | capitalize }}">
                                            <img  class="avatar" src="{{ asset('uploads/picture/' ~ schoolUser.user.picture) }}" />
                                        </a>
                                    </li> 
                                </ul>
                                {% set break = loop.index0 > 1 %}
                                {% endfor %}
                            {% endif %}
                                    <div class="dropdown card-options">
                                        <button class="btn-options" type="button" id="task-dropdown-button-1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="material-icons">more_vert</i>
                                        </button>
                                        <div class="dropdown-menu dropdown-menu-right">
                                            <a class="dropdown-item" href="#">Edit</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item text-danger" href="#">Delete</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                                    
                        {% if faculty.issuances is not empty %}
                            
                        <div id="{{ faculty.label |replace({' ': '-' ,',': '-' }) }}" class="collapse" aria-labelledby="{{ faculty.label |replace({' ': '-' }) }}" >
                            {% for degreeField in faculty.degreeField %}
                            
                            {% if degreeField.issuances is not empty %}
                            
                            {% for issuance in degreeField.issuances %}
    
                            {% if issuance.degreeType.id == '8189421e-f7c6-11e8-8302-323a8a08878d'%}
                            
                                <div class="row content-list-head">
                                <div class="col-auto">
                                    <h5 style="color:#353A40;letter-spacing:0.05em">{{ degreeField.label }}</h5>
                                </div>
                            </div>
                            
                            <div class="content-list-body row" >
    
                            
                                
                                <div class="col-md-6">   
                                {# class list #}
                                
                                    <div class="card card-team" style="background-color:white;height:218px" >
                                        {% if issuance.getGraduateUserInvites() is empty %}
                                        <div class="progress">
                                            <div class="progress-bar bg-warning" role="progressbar" style="width: 100%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        {% else %}
                                            <div class="progress">
                                            <div class="progress-bar bg" style="width:100%; background-color: #006400"></div>
                                        </div>
                                        {% endif %}
                                        <div class="card-body" >
                                            <div class="dropdown card-options">
                                                <button class="btn-options" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    <i class="material-icons">more_vert</i>
                                                </button>
                                                <div class="dropdown-menu dropdown-menu-right">
                                                    <a class="dropdown-item" href="#">Edit</a>
                                                    <div class="dropdown-divider"></div>
                                                    <a class="dropdown-item text-danger" data-toggle="modal" data-target="#confirmDelete" data-title="Delete User" data-message="Are you sure you want to delete this user ?" >Delete</a>
                                                </div>
                                            </div>
                                            <div class="card-title">
                                                <a href="{{ path('issuances', { issuance: issuance.id }) }}">
                                                    <h5 data-filter-by="text" style="color:#353A40">Class {{ issuance.classYearStart|date('Y') }} - {{ issuance.classYearEnd|date('Y') }} | <span style='font-size:small;letter-spacing: 0.05em'>{{ issuance.degreeField.label | capitalize }} <span></h5>
                                                </a>
                                                <span style='font-size:small'> 
                                                {% if issuance.degreeTitle.label > 45 %}
                                                {% set degreeName =  issuance.degreeTitle.label|slice(0, 45) %}
                                                {% set degreeName  = schoolName ~ '...' %}
                                            {% else %}
                                                {% set degreeName  =  issuance.degreeTitle.label %}
                                            {% endif %}
    
                                            {{ degreeName  |capitalize }}
                                                </span>
                                            </div> 
                                                
                                            <div class="card-meta d-flex">
                                            
    
                                            {% if issuance.GraduateUsers is not empty %}
                                                {% set break = false %}
                                                {% for graduates in issuance.GraduateUsers if not break %}
                                                    {% if loop.first %}
                                                            <ul class="avatars" style="display:inline;">
                                                        <li> 
                                                            <a href="{{ path("visitProfile", {id: graduates.user.id }) }}" data-toggle="tooltip" title="{{ graduates.user.firstname | capitalize }} {{ graduates.user.lastname | capitalize }}">
                                                                <img class="avatar" src="{{ asset('uploads/picture/' ~ graduates.user.picture) }}" />
                                                            </a>
                                                        </li> 
                                                    </ul>
    
                                                    {% else %}
                                                    <ul class="avatars" style="display:inline;margin-left:-13px">
                                                        <li> 
                                                            <a href="{{ path("visitProfile", {id: graduates.user.id }) }}" data-toggle="tooltip" title="{{ graduates.user.firstname | capitalize }} {{ graduates.user.lastname | capitalize }}">
                                                                <img class="avatar" src="{{ asset('uploads/picture/' ~ graduates.user.picture) }}" />
                                                            </a>
                                                        </li> 
                                                    </ul>
                                                    {% endif %}
                                                {% set break = loop.index0 > 3 %}
                                                {% endfor %}
                                            {% endif %}
                                                            {# endDate and startDate are strings or DateTime objects #}
                                                {# {% if issuance.dueDate < date() %}
                                                <span class="text-small" data-filter-by="text" title='{{ issuance.dueDate|date('Y') }}' style='color:grey'>Due on {{issuance.dueDate|date('d-m-Y') }}</span>
                                                {% else %}
    
                                                    {% set difference = date(issuance.dueDate).diff(date()) %}
                                                    {% set leftDays = difference.days %}
                                                    {% if leftDays == 1 %}
                                                <span class="text-small" data-filter-by="text" title='{{ issuance.dueDate|date('Y') }}' style='color:grey'>Due 1 days</span>
                                                    {% elseif leftDays == 0 %}
                                                <span class="text-small" data-filter-by="text" title='{{ issuance.dueDate|date('Y') }}' style='color:grey'>Due today</span>
                                                    {% else %}                           
                                                <span class="text-small" data-filter-by="text" title='{{ issuance.dueDate|date('Y') }}' style='color:grey'>Due {{ leftDays }} days</span>
                                                    {% endif %}
                                                {% endif %} #}
                                            </div>
                                        </div>
                                    </div>
                                
                                
                                    {# End class list #}
                                
                                    {# Modal Delete Dialog #}
                                    <div class="modal fade" id="confirmDelete" role="dialog" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                        <div class="modal-header" style="background-color:white;border-bottom:1px solid #F4F3EF;">
                                            <h4 class="modal-title text-left" style="color:#ffc107;padding-right:320px">Delete Faculty</h4>
                                            <i class="fas fa-times" data-dismiss="modal" style="color:#353A40;padding-top:10px"></i>
                                        </div>
                                        <div class="modal-body" style="height:200px;margin:auto;color:#353A40;padding-top:30px">
                                            <p style="color:#353A40">
                                            
                                            The <strong> Graduation class {{ issuance.classYearStart|date('Y') }} - {{ issuance.classYearEnd|date('Y') }} - Master in business engineering </strong>  will be removed from <strong>{{ issuance.school.name |capitalize}}</strong> account. 
                                            </p>
                                            <p>
                                            You can edit the faculty if you want to change something.
                                            Are you sure you want to delete it?
                                            </p>
    
                                        </div>
                                        <div class="modal-footer" style="background-color:white;border-top:1px solid #F4F3EF;">
                                            <button class="btn btn-link text-#353A40" style="color:#353A40;" data-dismiss="modal">Cancel</button>
                                            {# <a class="btn btn-outline-primary" style="color:#353A40;" id="confirm" href="{{ path("deleteFaculty", { "faculty": faculty.id }) }}">
                                                Delete
                                            </a> #}
                                        </div>
                                        </div>
                                    </div>
                                    </div>
                                    {# End Modal Delete Dialog #}
    
                                </div>  
                                    
                            
                        
                            </div>
                            {% endif %}
                            {% endfor %}
                            {% endif %}
                            {% endfor %}
                        </div>
                        {% endif %}
                        
                    {% endfor %}
                    </div>
                    {% endif %}
                </div>    
            </div>
        </div> 
  

    <div class="tab-pane fade" id="DDD" role="tabpanel" aria-labelledby="DDD-tab">
            <div class="content-list-body">  
            
                    <div class="card-list" style='background-color: #F7F9FA;margin-bottom:200px'>
                        <div class="card-list-head">
                            <h4 style='letter-spacing: 0.05em;'>Faculties</h4>
                        </div>
        
                        {% if is_granted('ROLE_SCHOOL_USER_ADMIN') %}
                        <div class="card-list-body" >
                            {% for faculty in faculties %}         
                            <div class="card card-task" style='background-color: white;'>
                                <div class="card-body">
                                    <div class="card-title">
                                        <a data-toggle="collapse" href="#{{ faculty.label |replace({' ': '-' ,',': '-' }) }}" role="button" aria-expanded="false" aria-controls="{{ faculty.label |replace({' ': '-' }) }}">
                                            <h5 data-filter-by="text" style='letter-spacing: 0.05em;'>{{ faculty.label }}</h5>
                                        </a>
                                        {# <span class="text-small">Today</span> #}
                                    </div>
                                    <div class="card-meta">
                                        
                                    {% if faculty.schoolUsers is not empty %}
                                    {% set break = false %}
                                    {% for schoolUser in faculty.schoolUsers if not break %}
                                    <ul class="avatars" style="display:inline;margin-left:-12px">
                                        <li> 
                                            <a href="{{ path("visitProfile", {id: schoolUser.user.id}) }}" data-toggle="tooltip" title="{{ schoolUser.user.firstname | capitalize }} {{ schoolUser.user.lastname | capitalize }}">
                                                <img  class="avatar" src="{{ asset('uploads/picture/' ~ schoolUser.user.picture) }}" />
                                            </a>
                                        </li> 
                                    </ul>
                                    {% set break = loop.index0 > 1 %}
                                    {% endfor %}
                                {% endif %}
                                        <div class="dropdown card-options">
                                            <button class="btn-options" type="button" id="task-dropdown-button-1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <i class="material-icons">more_vert</i>
                                            </button>
                                            <div class="dropdown-menu dropdown-menu-right">
                                                <a class="dropdown-item" href="#">Edit</a>
                                                <div class="dropdown-divider"></div>
                                                <a class="dropdown-item text-danger" href="#">Delete</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                                        
                            {% if faculty.issuances is not empty %}
                                
                            <div id="{{ faculty.label |replace({' ': '-' ,',': '-' }) }}" class="collapse" aria-labelledby="{{ faculty.label |replace({' ': '-' }) }}" >
                                {% for degreeField in faculty.degreeField %}
                                
                                {% if degreeField.issuances is not empty %}
                                
                                {% for issuance in degreeField.issuances %}
        
                                {% if issuance.degreeType.id == '8189421e-f7c6-11e8-8302-323a8a08878d'%}
                                
                                    <div class="row content-list-head">
                                    <div class="col-auto">
                                        <h5 style="color:#353A40;letter-spacing:0.05em">{{ degreeField.label }}</h5>
                                    </div>
                                </div>
                                
                                <div class="content-list-body row" >
        
                                
                                    
                                    <div class="col-md-6">   
                                    {# class list #}
                                    
                                        <div class="card card-team" style="background-color:white;height:218px" >
                                            {% if issuance.getGraduateUserInvites() is empty %}
                                            <div class="progress">
                                                <div class="progress-bar bg-warning" role="progressbar" style="width: 100%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                            {% else %}
                                                <div class="progress">
                                                <div class="progress-bar bg" style="width:100%; background-color: #006400"></div>
                                            </div>
                                            {% endif %}
                                            <div class="card-body" >
                                                <div class="dropdown card-options">
                                                    <button class="btn-options" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                        <i class="material-icons">more_vert</i>
                                                    </button>
                                                    <div class="dropdown-menu dropdown-menu-right">
                                                        <a class="dropdown-item" href="#">Edit</a>
                                                        <div class="dropdown-divider"></div>
                                                        <a class="dropdown-item text-danger" data-toggle="modal" data-target="#confirmDelete" data-title="Delete User" data-message="Are you sure you want to delete this user ?" >Delete</a>
                                                    </div>
                                                </div>
                                                <div class="card-title">
                                                    <a href="{{ path('issuances', { issuance: issuance.id }) }}">
                                                        <h5 data-filter-by="text" style="color:#353A40">Class {{ issuance.classYearStart|date('Y') }} - {{ issuance.classYearEnd|date('Y') }} | <span style='font-size:small;letter-spacing: 0.05em'>{{ issuance.degreeField.label | capitalize }} <span></h5>
                                                    </a>
                                                    <span style='font-size:small'> 
                                                    {% if issuance.degreeTitle.label > 45 %}
                                                    {% set degreeName =  issuance.degreeTitle.label|slice(0, 45) %}
                                                    {% set degreeName  = schoolName ~ '...' %}
                                                {% else %}
                                                    {% set degreeName  =  issuance.degreeTitle.label %}
                                                {% endif %}
        
                                                {{ degreeName  |capitalize }}
                                                    </span>
                                                </div> 
                                                    
                                                <div class="card-meta d-flex">
                                                
        
                                                {% if issuance.GraduateUsers is not empty %}
                                                    {% set break = false %}
                                                    {% for graduates in issuance.GraduateUsers if not break %}
                                                        {% if loop.first %}
                                                                <ul class="avatars" style="display:inline;">
                                                            <li> 
                                                                <a href="{{ path("visitProfile", {id: graduates.user.id }) }}" data-toggle="tooltip" title="{{ graduates.user.firstname | capitalize }} {{ graduates.user.lastname | capitalize }}">
                                                                    <img class="avatar" src="{{ asset('uploads/picture/' ~ graduates.user.picture) }}" />
                                                                </a>
                                                            </li> 
                                                        </ul>
        
                                                        {% else %}
                                                        <ul class="avatars" style="display:inline;margin-left:-13px">
                                                            <li> 
                                                                <a href="{{ path("visitProfile", {id: graduates.user.id }) }}" data-toggle="tooltip" title="{{ graduates.user.firstname | capitalize }} {{ graduates.user.lastname | capitalize }}">
                                                                    <img class="avatar" src="{{ asset('uploads/picture/' ~ graduates.user.picture) }}" />
                                                                </a>
                                                            </li> 
                                                        </ul>
                                                        {% endif %}
                                                    {% set break = loop.index0 > 3 %}
                                                    {% endfor %}
                                                {% endif %}
                                                                {# endDate and startDate are strings or DateTime objects #}
                                                    {# {% if issuance.dueDate < date() %}
                                                    <span class="text-small" data-filter-by="text" title='{{ issuance.dueDate|date('Y') }}' style='color:grey'>Due on {{issuance.dueDate|date('d-m-Y') }}</span>
                                                    {% else %}
        
                                                        {% set difference = date(issuance.dueDate).diff(date()) %}
                                                        {% set leftDays = difference.days %}
                                                        {% if leftDays == 1 %}
                                                    <span class="text-small" data-filter-by="text" title='{{ issuance.dueDate|date('Y') }}' style='color:grey'>Due 1 days</span>
                                                        {% elseif leftDays == 0 %}
                                                    <span class="text-small" data-filter-by="text" title='{{ issuance.dueDate|date('Y') }}' style='color:grey'>Due today</span>
                                                        {% else %}                           
                                                    <span class="text-small" data-filter-by="text" title='{{ issuance.dueDate|date('Y') }}' style='color:grey'>Due {{ leftDays }} days</span>
                                                        {% endif %}
                                                    {% endif %} #}
                                                </div>
                                            </div>
                                        </div>
                                    
                                    
                                        {# End class list #}
                                    
                                        {# Modal Delete Dialog #}
                                        <div class="modal fade" id="confirmDelete" role="dialog" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                            <div class="modal-header" style="background-color:white;border-bottom:1px solid #F4F3EF;">
                                                <h4 class="modal-title text-left" style="color:#ffc107;padding-right:320px">Delete Faculty</h4>
                                                <i class="fas fa-times" data-dismiss="modal" style="color:#353A40;padding-top:10px"></i>
                                            </div>
                                            <div class="modal-body" style="height:200px;margin:auto;color:#353A40;padding-top:30px">
                                                <p style="color:#353A40">
                                                
                                                The <strong> Graduation class {{ issuance.classYearStart|date('Y') }} - {{ issuance.classYearEnd|date('Y') }} - Master in business engineering </strong>  will be removed from <strong>{{ issuance.school.name |capitalize}}</strong> account. 
                                                </p>
                                                <p>
                                                You can edit the faculty if you want to change something.
                                                Are you sure you want to delete it?
                                                </p>
        
                                            </div>
                                            <div class="modal-footer" style="background-color:white;border-top:1px solid #F4F3EF;">
                                                <button class="btn btn-link text-#353A40" style="color:#353A40;" data-dismiss="modal">Cancel</button>
                                                {# <a class="btn btn-outline-primary" style="color:#353A40;" id="confirm" href="{{ path("deleteFaculty", { "faculty": faculty.id }) }}">
                                                    Delete
                                                </a> #}
                                            </div>
                                            </div>
                                        </div>
                                        </div>
                                        {# End Modal Delete Dialog #}
        
                                    </div>  
                                        
                                
                            
                                </div>
                                {% endif %}
                                {% endfor %}
                                {% endif %}
                                {% endfor %}
                            </div>
                            {% endif %}
                            
                        {% endfor %}
                        </div>
                        {% endif %}
                    </div>    
                </div>
            </div> 

        
        
    
        </div>
    </div>

</div>

{% endblock %}


